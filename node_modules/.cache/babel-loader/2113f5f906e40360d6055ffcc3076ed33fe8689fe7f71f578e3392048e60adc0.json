{"ast":null,"code":"// frontend-service/src/services/api.js\nimport axios from 'axios';\nimport { isTokenExpired, refreshAccessToken, clearTokens } from './auth';\nconst apiClient = axios.create({\n  baseURL: 'http://localhost:8000',\n  //process.env.REACT_APP_API_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\napiClient.interceptors.request.use(async config => {\n  var _document$cookie$spli;\n  const publicEndpoints = ['/signup', '/verify/verify-email', '/verify/confirm-email'];\n\n  // Skip adding Authorization header for  these endpoints\n  if (publicEndpoints.some(endpoint => config.url.includes(endpoint))) {\n    console.log(`Skipping interceptor for ${config.url}`);\n    return config;\n  }\n  let accessToken = sessionStorage.getItem('accessToken');\n  const refreshToken = (_document$cookie$spli = document.cookie.split('; ').find(row => row.startsWith('refreshToken='))) === null || _document$cookie$spli === void 0 ? void 0 : _document$cookie$spli.split('=')[1];\n  console.log('Current Access Token:', accessToken);\n  console.log('Current Refresh Token:', refreshToken);\n  if (!accessToken || isTokenExpired(accessToken)) {\n    if (!refreshToken) {\n      console.error('No refresh token found, redirecting to login...');\n      clearTokens();\n      window.location.href = '/LoginPage';\n      return Promise.reject(new Error('No refresh token found.'));\n    }\n    try {\n      console.log('Refreshing Access Token...');\n      accessToken = await refreshAccessToken(refreshToken);\n    } catch (error) {\n      console.error('Token refresh failed, redirecting to login...');\n      clearTokens();\n      window.location.href = '/LoginPage';\n      return Promise.reject(error);\n    }\n  }\n  config.headers.Authorization = `Bearer ${accessToken}`;\n  return config;\n});\nexport default apiClient;","map":{"version":3,"names":["axios","isTokenExpired","refreshAccessToken","clearTokens","apiClient","create","baseURL","headers","interceptors","request","use","config","_document$cookie$spli","publicEndpoints","some","endpoint","url","includes","console","log","accessToken","sessionStorage","getItem","refreshToken","document","cookie","split","find","row","startsWith","error","window","location","href","Promise","reject","Error","Authorization"],"sources":["/Users/pbh7080/Desktop/project/ITeaMoa/frontend-service/src/services/api.js"],"sourcesContent":["// frontend-service/src/services/api.js\nimport axios from 'axios';\nimport { isTokenExpired, refreshAccessToken, clearTokens } from './auth';\n\nconst apiClient = axios.create({\n    baseURL: 'http://localhost:8000', //process.env.REACT_APP_API_URL,\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\napiClient.interceptors.request.use(async (config) => {\n    const publicEndpoints = ['/signup', '/verify/verify-email', '/verify/confirm-email'];\n\n    // Skip adding Authorization header for  these endpoints\n    if (publicEndpoints.some(endpoint => config.url.includes(endpoint))) {\n        console.log(`Skipping interceptor for ${config.url}`);\n        return config;\n    }\n\n    let accessToken = sessionStorage.getItem('accessToken');\n    const refreshToken = document.cookie.split('; ').find(row => row.startsWith('refreshToken='))\n                        ?.split('=')[1];\n\n    console.log('Current Access Token:', accessToken);\n    console.log('Current Refresh Token:', refreshToken);\n\n    if (!accessToken || isTokenExpired(accessToken)) {\n        if (!refreshToken) {\n            console.error('No refresh token found, redirecting to login...');\n            clearTokens();\n            window.location.href = '/LoginPage';\n            return Promise.reject(new Error('No refresh token found.'));\n        }\n\n        try {\n            console.log('Refreshing Access Token...');\n            accessToken = await refreshAccessToken(refreshToken);\n        } catch (error) {\n            console.error('Token refresh failed, redirecting to login...');\n            clearTokens();\n            window.location.href = '/LoginPage';\n            return Promise.reject(error);\n        }\n    }\n\n    config.headers.Authorization = `Bearer ${accessToken}`;\n    return config;\n});\n\nexport default apiClient;\n"],"mappings":"AAAA;AACA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,cAAc,EAAEC,kBAAkB,EAAEC,WAAW,QAAQ,QAAQ;AAExE,MAAMC,SAAS,GAAGJ,KAAK,CAACK,MAAM,CAAC;EAC3BC,OAAO,EAAE,uBAAuB;EAAE;EAClCC,OAAO,EAAE;IACL,cAAc,EAAE;EACpB;AACJ,CAAC,CAAC;AAEFH,SAAS,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,MAAOC,MAAM,IAAK;EAAA,IAAAC,qBAAA;EACjD,MAAMC,eAAe,GAAG,CAAC,SAAS,EAAE,sBAAsB,EAAE,uBAAuB,CAAC;;EAEpF;EACA,IAAIA,eAAe,CAACC,IAAI,CAACC,QAAQ,IAAIJ,MAAM,CAACK,GAAG,CAACC,QAAQ,CAACF,QAAQ,CAAC,CAAC,EAAE;IACjEG,OAAO,CAACC,GAAG,CAAC,4BAA4BR,MAAM,CAACK,GAAG,EAAE,CAAC;IACrD,OAAOL,MAAM;EACjB;EAEA,IAAIS,WAAW,GAAGC,cAAc,CAACC,OAAO,CAAC,aAAa,CAAC;EACvD,MAAMC,YAAY,IAAAX,qBAAA,GAAGY,QAAQ,CAACC,MAAM,CAACC,KAAK,CAAC,IAAI,CAAC,CAACC,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACC,UAAU,CAAC,eAAe,CAAC,CAAC,cAAAjB,qBAAA,uBAAxEA,qBAAA,CACCc,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;EAEnCR,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEC,WAAW,CAAC;EACjDF,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAEI,YAAY,CAAC;EAEnD,IAAI,CAACH,WAAW,IAAInB,cAAc,CAACmB,WAAW,CAAC,EAAE;IAC7C,IAAI,CAACG,YAAY,EAAE;MACfL,OAAO,CAACY,KAAK,CAAC,iDAAiD,CAAC;MAChE3B,WAAW,CAAC,CAAC;MACb4B,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,YAAY;MACnC,OAAOC,OAAO,CAACC,MAAM,CAAC,IAAIC,KAAK,CAAC,yBAAyB,CAAC,CAAC;IAC/D;IAEA,IAAI;MACAlB,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;MACzCC,WAAW,GAAG,MAAMlB,kBAAkB,CAACqB,YAAY,CAAC;IACxD,CAAC,CAAC,OAAOO,KAAK,EAAE;MACZZ,OAAO,CAACY,KAAK,CAAC,+CAA+C,CAAC;MAC9D3B,WAAW,CAAC,CAAC;MACb4B,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,YAAY;MACnC,OAAOC,OAAO,CAACC,MAAM,CAACL,KAAK,CAAC;IAChC;EACJ;EAEAnB,MAAM,CAACJ,OAAO,CAAC8B,aAAa,GAAG,UAAUjB,WAAW,EAAE;EACtD,OAAOT,MAAM;AACjB,CAAC,CAAC;AAEF,eAAeP,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}