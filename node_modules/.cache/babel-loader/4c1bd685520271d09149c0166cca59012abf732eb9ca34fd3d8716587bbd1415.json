{"ast":null,"code":"// frontend-service/src/services/auth.js\nimport{jwtDecode}from'jwt-decode';import axios from'axios';// Check if the token is expired\nexport const isTokenExpired=token=>{if(!token){console.error('Invalid token format:',token);return true;// Consider invalid tokens as expired\n}try{const{exp}=jwtDecode(token);const currentTime=Math.floor(Date.now()/1000);return exp<currentTime;}catch(error){console.error('Error decoding token:',error);return true;// Treat decoding errors as expired tokens\n}};// Store tokens securely\nexport const storeTokens=function(accessToken,idToken,refreshToken){let rememberMe=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;console.log('Storing tokens...',{accessToken,idToken,refreshToken});if(rememberMe){localStorage.setItem('accessToken',accessToken);localStorage.setItem('idToken',idToken);}else{sessionStorage.setItem('accessToken',accessToken);sessionStorage.setItem('idToken',idToken);}// console.log('Stored Access Token:', sessionStorage.getItem('accessToken'));\n// console.log('Stored ID Token:', sessionStorage.getItem('idToken'));\n// If the backend does not set the cookie, fallback to this (not HttpOnly)\nif(refreshToken){// console.log('Storing refresh token in cookie:', refreshToken);\ndocument.cookie=`refreshToken=${refreshToken}; Secure; SameSite=Strict; Path=/;`;}else{console.warn('No refresh token provided!');}};// Refresh tokens\nexport const refreshAccessToken=async(email,refreshToken)=>{try{const response=await axios.post('/refresh',{email,refresh_token:refreshToken}// Include email and refresh_token in the request body\n// { withCredentials: true } // Include credentials if required\n);const{accessToken,idToken}=response.data;// Update tokens in storage\nsessionStorage.setItem('accessToken',accessToken);sessionStorage.setItem('idToken',idToken);return accessToken;// Return the new access token\n}catch(error){console.error('Token refresh failed',error);throw error;// Propagate the error for the caller to handle\n}};export const clearTokens=()=>{sessionStorage.removeItem('accessToken');sessionStorage.removeItem('idToken');localStorage.removeItem('accessToken');localStorage.removeItem('idToken');document.cookie='refreshToken=; Max-Age=0; Secure; SameSite=Strict';};","map":{"version":3,"names":["jwtDecode","axios","isTokenExpired","token","console","error","exp","currentTime","Math","floor","Date","now","storeTokens","accessToken","idToken","refreshToken","rememberMe","arguments","length","undefined","log","localStorage","setItem","sessionStorage","document","cookie","warn","refreshAccessToken","email","response","post","refresh_token","data","clearTokens","removeItem"],"sources":["/Users/pbh7080/Desktop/project/ITeaMoa/frontend-service/src/services/auth.js"],"sourcesContent":["// frontend-service/src/services/auth.js\nimport {jwtDecode} from 'jwt-decode';\nimport axios from 'axios';\n\n// Check if the token is expired\nexport const isTokenExpired = (token) => {\n    if (!token) {\n        console.error('Invalid token format:', token);\n        return true; // Consider invalid tokens as expired\n    }\n\n    try {\n        const { exp } = jwtDecode(token);\n        const currentTime = Math.floor(Date.now() / 1000);\n        return exp < currentTime;\n    } catch (error) {\n        console.error('Error decoding token:', error);\n        return true; // Treat decoding errors as expired tokens\n    }\n};\n\n// Store tokens securely\nexport const storeTokens = (accessToken, idToken, refreshToken, rememberMe = false) => {\n    console.log('Storing tokens...', { accessToken, idToken, refreshToken });\n    if (rememberMe) {\n        localStorage.setItem('accessToken', accessToken);\n        localStorage.setItem('idToken', idToken);\n    } else {\n        sessionStorage.setItem('accessToken', accessToken);\n        sessionStorage.setItem('idToken', idToken);\n    }\n\n    // console.log('Stored Access Token:', sessionStorage.getItem('accessToken'));\n    // console.log('Stored ID Token:', sessionStorage.getItem('idToken'));\n\n    // If the backend does not set the cookie, fallback to this (not HttpOnly)\n    if (refreshToken) {\n        // console.log('Storing refresh token in cookie:', refreshToken);\n        document.cookie = `refreshToken=${refreshToken}; Secure; SameSite=Strict; Path=/;`;\n      } else {\n        console.warn('No refresh token provided!');\n      }\n};\n\n// Refresh tokens\nexport const refreshAccessToken = async (email, refreshToken) => {\n    try {\n        const response = await axios.post(\n            '/refresh',\n            { email, refresh_token: refreshToken }, // Include email and refresh_token in the request body\n            // { withCredentials: true } // Include credentials if required\n        );\n\n        const { accessToken, idToken } = response.data;\n\n        // Update tokens in storage\n        sessionStorage.setItem('accessToken', accessToken);\n        sessionStorage.setItem('idToken', idToken);\n\n        return accessToken; // Return the new access token\n    } catch (error) {\n        console.error('Token refresh failed', error);\n        throw error; // Propagate the error for the caller to handle\n    }\n};\n\nexport const clearTokens = () => {\n    sessionStorage.removeItem('accessToken');\n    sessionStorage.removeItem('idToken');\n    localStorage.removeItem('accessToken');\n    localStorage.removeItem('idToken');\n\n    document.cookie = 'refreshToken=; Max-Age=0; Secure; SameSite=Strict';\n};"],"mappings":"AAAA;AACA,OAAQA,SAAS,KAAO,YAAY,CACpC,MAAO,CAAAC,KAAK,KAAM,OAAO,CAEzB;AACA,MAAO,MAAM,CAAAC,cAAc,CAAIC,KAAK,EAAK,CACrC,GAAI,CAACA,KAAK,CAAE,CACRC,OAAO,CAACC,KAAK,CAAC,uBAAuB,CAAEF,KAAK,CAAC,CAC7C,MAAO,KAAI,CAAE;AACjB,CAEA,GAAI,CACA,KAAM,CAAEG,GAAI,CAAC,CAAGN,SAAS,CAACG,KAAK,CAAC,CAChC,KAAM,CAAAI,WAAW,CAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACC,GAAG,CAAC,CAAC,CAAG,IAAI,CAAC,CACjD,MAAO,CAAAL,GAAG,CAAGC,WAAW,CAC5B,CAAE,MAAOF,KAAK,CAAE,CACZD,OAAO,CAACC,KAAK,CAAC,uBAAuB,CAAEA,KAAK,CAAC,CAC7C,MAAO,KAAI,CAAE;AACjB,CACJ,CAAC,CAED;AACA,MAAO,MAAM,CAAAO,WAAW,CAAG,QAAAA,CAACC,WAAW,CAAEC,OAAO,CAAEC,YAAY,CAAyB,IAAvB,CAAAC,UAAU,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,KAAK,CAC9Eb,OAAO,CAACgB,GAAG,CAAC,mBAAmB,CAAE,CAAEP,WAAW,CAAEC,OAAO,CAAEC,YAAa,CAAC,CAAC,CACxE,GAAIC,UAAU,CAAE,CACZK,YAAY,CAACC,OAAO,CAAC,aAAa,CAAET,WAAW,CAAC,CAChDQ,YAAY,CAACC,OAAO,CAAC,SAAS,CAAER,OAAO,CAAC,CAC5C,CAAC,IAAM,CACHS,cAAc,CAACD,OAAO,CAAC,aAAa,CAAET,WAAW,CAAC,CAClDU,cAAc,CAACD,OAAO,CAAC,SAAS,CAAER,OAAO,CAAC,CAC9C,CAEA;AACA;AAEA;AACA,GAAIC,YAAY,CAAE,CACd;AACAS,QAAQ,CAACC,MAAM,CAAG,gBAAgBV,YAAY,oCAAoC,CACpF,CAAC,IAAM,CACLX,OAAO,CAACsB,IAAI,CAAC,4BAA4B,CAAC,CAC5C,CACN,CAAC,CAED;AACA,MAAO,MAAM,CAAAC,kBAAkB,CAAG,KAAAA,CAAOC,KAAK,CAAEb,YAAY,GAAK,CAC7D,GAAI,CACA,KAAM,CAAAc,QAAQ,CAAG,KAAM,CAAA5B,KAAK,CAAC6B,IAAI,CAC7B,UAAU,CACV,CAAEF,KAAK,CAAEG,aAAa,CAAEhB,YAAa,CAAG;AACxC;AACJ,CAAC,CAED,KAAM,CAAEF,WAAW,CAAEC,OAAQ,CAAC,CAAGe,QAAQ,CAACG,IAAI,CAE9C;AACAT,cAAc,CAACD,OAAO,CAAC,aAAa,CAAET,WAAW,CAAC,CAClDU,cAAc,CAACD,OAAO,CAAC,SAAS,CAAER,OAAO,CAAC,CAE1C,MAAO,CAAAD,WAAW,CAAE;AACxB,CAAE,MAAOR,KAAK,CAAE,CACZD,OAAO,CAACC,KAAK,CAAC,sBAAsB,CAAEA,KAAK,CAAC,CAC5C,KAAM,CAAAA,KAAK,CAAE;AACjB,CACJ,CAAC,CAED,MAAO,MAAM,CAAA4B,WAAW,CAAGA,CAAA,GAAM,CAC7BV,cAAc,CAACW,UAAU,CAAC,aAAa,CAAC,CACxCX,cAAc,CAACW,UAAU,CAAC,SAAS,CAAC,CACpCb,YAAY,CAACa,UAAU,CAAC,aAAa,CAAC,CACtCb,YAAY,CAACa,UAAU,CAAC,SAAS,CAAC,CAElCV,QAAQ,CAACC,MAAM,CAAG,mDAAmD,CACzE,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}