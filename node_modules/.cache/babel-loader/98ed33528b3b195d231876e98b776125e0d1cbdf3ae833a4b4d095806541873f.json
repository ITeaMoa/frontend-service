{"ast":null,"code":"// frontend-service/src/services/api.js\nimport axios from'axios';import{isTokenExpired,refreshAccessToken,clearTokens}from'./auth';const apiClient=axios.create({baseURL:'http://localhost:8000',//process.env.REACT_APP_API_URL,\nheaders:{'Content-Type':'application/json'}});apiClient.interceptors.request.use(async config=>{var _document$cookie$spli;// Skip adding Authorization header for signin\nif(config.url==='/signin'){console.log('Skipping interceptor for /signin');return config;}let accessToken=sessionStorage.getItem('accessToken');const refreshToken=(_document$cookie$spli=document.cookie.split('; ').find(row=>row.startsWith('refreshToken=')))===null||_document$cookie$spli===void 0?void 0:_document$cookie$spli.split('=')[1];console.log('Current Access Token:',accessToken);console.log('Current Refresh Token:',refreshToken);if(!accessToken||isTokenExpired(accessToken)){if(!refreshToken){console.error('No refresh token found, redirecting to login...');clearTokens();window.location.href='/LoginPage';return Promise.reject(new Error('No refresh token found.'));}try{console.log('Refreshing Access Token...');accessToken=await refreshAccessToken(refreshToken);}catch(error){console.error('Token refresh failed, redirecting to login...');clearTokens();window.location.href='/LoginPage';return Promise.reject(error);}}config.headers.Authorization=`Bearer ${accessToken}`;return config;});export default apiClient;","map":{"version":3,"names":["axios","isTokenExpired","refreshAccessToken","clearTokens","apiClient","create","baseURL","headers","interceptors","request","use","config","_document$cookie$spli","url","console","log","accessToken","sessionStorage","getItem","refreshToken","document","cookie","split","find","row","startsWith","error","window","location","href","Promise","reject","Error","Authorization"],"sources":["/Users/pbh7080/Desktop/project/ITeaMoa/frontend-service/src/services/api.js"],"sourcesContent":["// frontend-service/src/services/api.js\nimport axios from 'axios';\nimport { isTokenExpired, refreshAccessToken, clearTokens } from './auth';\n\nconst apiClient = axios.create({\n    baseURL: 'http://localhost:8000', //process.env.REACT_APP_API_URL,\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\napiClient.interceptors.request.use(async (config) => {\n    // Skip adding Authorization header for signin\n    if (config.url === '/signin') {\n        console.log('Skipping interceptor for /signin');\n        return config;\n    }\n\n    let accessToken = sessionStorage.getItem('accessToken');\n    const refreshToken = document.cookie.split('; ').find(row => row.startsWith('refreshToken='))\n                        ?.split('=')[1];\n\n    console.log('Current Access Token:', accessToken);\n    console.log('Current Refresh Token:', refreshToken);\n\n    if (!accessToken || isTokenExpired(accessToken)) {\n        if (!refreshToken) {\n            console.error('No refresh token found, redirecting to login...');\n            clearTokens();\n            window.location.href = '/LoginPage';\n            return Promise.reject(new Error('No refresh token found.'));\n        }\n\n        try {\n            console.log('Refreshing Access Token...');\n            accessToken = await refreshAccessToken(refreshToken);\n        } catch (error) {\n            console.error('Token refresh failed, redirecting to login...');\n            clearTokens();\n            window.location.href = '/LoginPage';\n            return Promise.reject(error);\n        }\n    }\n\n    config.headers.Authorization = `Bearer ${accessToken}`;\n    return config;\n});\n\nexport default apiClient;\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAASC,cAAc,CAAEC,kBAAkB,CAAEC,WAAW,KAAQ,QAAQ,CAExE,KAAM,CAAAC,SAAS,CAAGJ,KAAK,CAACK,MAAM,CAAC,CAC3BC,OAAO,CAAE,uBAAuB,CAAE;AAClCC,OAAO,CAAE,CACL,cAAc,CAAE,kBACpB,CACJ,CAAC,CAAC,CAEFH,SAAS,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,KAAO,CAAAC,MAAM,EAAK,KAAAC,qBAAA,CACjD;AACA,GAAID,MAAM,CAACE,GAAG,GAAK,SAAS,CAAE,CAC1BC,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAC,CAC/C,MAAO,CAAAJ,MAAM,CACjB,CAEA,GAAI,CAAAK,WAAW,CAAGC,cAAc,CAACC,OAAO,CAAC,aAAa,CAAC,CACvD,KAAM,CAAAC,YAAY,EAAAP,qBAAA,CAAGQ,QAAQ,CAACC,MAAM,CAACC,KAAK,CAAC,IAAI,CAAC,CAACC,IAAI,CAACC,GAAG,EAAIA,GAAG,CAACC,UAAU,CAAC,eAAe,CAAC,CAAC,UAAAb,qBAAA,iBAAxEA,qBAAA,CACCU,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAEnCR,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAEC,WAAW,CAAC,CACjDF,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAEI,YAAY,CAAC,CAEnD,GAAI,CAACH,WAAW,EAAIf,cAAc,CAACe,WAAW,CAAC,CAAE,CAC7C,GAAI,CAACG,YAAY,CAAE,CACfL,OAAO,CAACY,KAAK,CAAC,iDAAiD,CAAC,CAChEvB,WAAW,CAAC,CAAC,CACbwB,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,YAAY,CACnC,MAAO,CAAAC,OAAO,CAACC,MAAM,CAAC,GAAI,CAAAC,KAAK,CAAC,yBAAyB,CAAC,CAAC,CAC/D,CAEA,GAAI,CACAlB,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC,CACzCC,WAAW,CAAG,KAAM,CAAAd,kBAAkB,CAACiB,YAAY,CAAC,CACxD,CAAE,MAAOO,KAAK,CAAE,CACZZ,OAAO,CAACY,KAAK,CAAC,+CAA+C,CAAC,CAC9DvB,WAAW,CAAC,CAAC,CACbwB,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,YAAY,CACnC,MAAO,CAAAC,OAAO,CAACC,MAAM,CAACL,KAAK,CAAC,CAChC,CACJ,CAEAf,MAAM,CAACJ,OAAO,CAAC0B,aAAa,CAAG,UAAUjB,WAAW,EAAE,CACtD,MAAO,CAAAL,MAAM,CACjB,CAAC,CAAC,CAEF,cAAe,CAAAP,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}