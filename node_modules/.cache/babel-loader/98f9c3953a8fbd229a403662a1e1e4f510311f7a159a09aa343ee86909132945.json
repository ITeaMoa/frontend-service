{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState}from'react';import axios from'axios';// axios 인스턴스 생성\nimport{jsx as _jsx}from\"react/jsx-runtime\";const apiClient=axios.create({baseURL:'http://localhost:8080'});// JWT 토큰을 Local Storage에 저장\nconst saveToken=token=>{localStorage.setItem('jwtToken',token);};// Local Storage에서 JWT 토큰을 읽기\nconst getToken=()=>{return localStorage.getItem('jwtToken');};// Local Storage에서 JWT 토큰 제거\nconst removeToken=()=>{localStorage.removeItem('jwtToken');};// JWT 토큰 유효성 검사\nconst isTokenExpired=token=>{if(!token)return true;const payload=JSON.parse(atob(token.split('.')[1]));const exp=payload.exp*1000;// exp는 초 단위로 되어 있으므로 밀리초로 변환\nreturn Date.now()>=exp;// 현재 시간과 만료 시간을 비교\n};// Context 생성\nexport const AuthContext=/*#__PURE__*/createContext();// Provider 컴포넌트\nexport const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[isLoggedIn,setIsLoggedIn]=useState(!!getToken());// 로컬 스토리지에서 사용자 정보와 JWT 토큰 가져오기\nuseEffect(()=>{const storedUser=localStorage.getItem('user');const token=getToken();// JWT 토큰 가져오기\nif(storedUser&&token){setUser(JSON.parse(storedUser));// 사용자 정보 설정\nsetIsLoggedIn(true);// 로그인 상태 업데이트\n}},[]);// 로그인 함수\nconst login=async(userId,password)=>{try{const response=await axios.post('http://localhost:8000/signin',{email:userId,password});if(response.status===200){const userData=response.data.user;// 사용자 정보\nconst token=response.data.token;// JWT\nsetUser(userData);saveToken(token);// 로컬 스토리지에 JWT 저장\nlocalStorage.setItem('user',JSON.stringify(userData));// 사용자 정보 저장\nsetIsLoggedIn(true);// 로그인 상태 업데이트\nreturn response;}}catch(error){console.error('로그인 실패:',error);throw error;// 오류를 상위로 전파\n}};//   // 소셜 로그인 함수\n//   const socialLogin = async (provider, { code, state }) => {\n//     try {\n//       const response = await apiClient.post(`/home/login/${provider}`, {\n//         code,\n//         state,\n//       });\n//       const userData = response.data.user; // 사용자 정보\n//       const token = response.data.token; // JWT\n//       setUser(userData);\n//       saveToken(token); // 로컬 스토리지에 JWT 저장\n//       localStorage.setItem('user', JSON.stringify(userData)); // 사용자 정보 저장\n//       setIsLoggedIn(true); // 로그인 상태 업데이트\n//       return response.data; // 응답 데이터 반환 (refreshToken 포함)\n//     } catch (error) {\n//       console.error('소셜 로그인 요청 중 오류 발생:', error);\n//       throw error; // 오류를 상위로 전파\n//     }\n//   };\nconst socialLogin=async(provider,_ref2)=>{let{code,state}=_ref2;try{const response=await apiClient.post(`/home/login/${provider}`,{code,state});return response.data;// 응답 데이터 반환 (refreshToken 포함)\n}catch(error){console.error('소셜 로그인 요청 중 오류 발생:',error);throw error;// 오류를 상위로 전파\n}};// // 소셜 로그인 함수\n// export const socialLogin = async (provider, accessToken) => {\n//     try {\n//       const response = await apiClient.post(`/home/login/${provider}`, {\n//         accessToken,\n//       });\n//       if (response.status === 200) {\n//         saveToken(response.data.token); // JWT 저장\n//         return response.data; // JWT 포함된 응답 데이터 반환\n//       }\n//     } catch (error) {\n//       console.error('소셜 로그인 실패:', error);\n//       throw error; // 오류를 상위로 전파\n//     }\n//   };\n// 로그아웃 함수\nconst logout=navigate=>{setUser(null);removeToken();// 로컬 스토리지에서 JWT 제거\nlocalStorage.removeItem('user');// 사용자 정보 제거\nsetIsLoggedIn(false);// 로그인 상태 업데이트\nnavigate(\"/\");// 홈으로 리디렉션\n};// Access Token 발급 요청 함수\nconst getAccessToken=async refreshToken=>{try{const response=await apiClient.post('http://localhost:8000/refresh',{email:\"pbh7080@gmail.com\",// 이메일을 하드코딩하거나 인자로 받을 수 있습니다.\nrefresh_token:refreshToken// 전달받은 refreshToken 사용\n});return response.data;// API 응답 반환\n}catch(error){console.error('Access Token 발급 요청 중 오류 발생:',error);return null;}};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,isLoggedIn,login,logout,socialLogin,getAccessToken},children:children});};//이거 이용하므로 export const으로 함수 export 할 필요 없음\n// Context 사용을 위한 커스텀 훅\nexport const useAuth=()=>{return useContext(AuthContext);};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","axios","jsx","_jsx","apiClient","create","baseURL","saveToken","token","localStorage","setItem","getToken","getItem","removeToken","removeItem","isTokenExpired","payload","JSON","parse","atob","split","exp","Date","now","AuthContext","AuthProvider","_ref","children","user","setUser","isLoggedIn","setIsLoggedIn","storedUser","login","userId","password","response","post","email","status","userData","data","stringify","error","console","socialLogin","provider","_ref2","code","state","logout","navigate","getAccessToken","refreshToken","refresh_token","Provider","value","useAuth"],"sources":["/Users/pbh7080/Desktop/project/ITeaMoa/frontend-service/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\nimport axios from 'axios';\n\n// axios 인스턴스 생성\nconst apiClient = axios.create({\n  baseURL: 'http://localhost:8080',\n});\n\n// JWT 토큰을 Local Storage에 저장\nconst saveToken = (token) => {\n  localStorage.setItem('jwtToken', token);\n};\n\n// Local Storage에서 JWT 토큰을 읽기\nconst getToken = () => {\n  return localStorage.getItem('jwtToken');\n};\n\n// Local Storage에서 JWT 토큰 제거\nconst removeToken = () => {\n  localStorage.removeItem('jwtToken');\n};\n\n// JWT 토큰 유효성 검사\nconst isTokenExpired = (token) => {\n  if (!token) return true;\n  const payload = JSON.parse(atob(token.split('.')[1]));\n  const exp = payload.exp * 1000; // exp는 초 단위로 되어 있으므로 밀리초로 변환\n  return Date.now() >= exp; // 현재 시간과 만료 시간을 비교\n};\n\n// Context 생성\nexport const AuthContext = createContext();\n\n// Provider 컴포넌트\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [isLoggedIn, setIsLoggedIn] = useState(!!getToken());\n\n  // 로컬 스토리지에서 사용자 정보와 JWT 토큰 가져오기\n  useEffect(() => {\n    const storedUser = localStorage.getItem('user');\n    const token = getToken(); // JWT 토큰 가져오기\n    if (storedUser && token) {\n      setUser(JSON.parse(storedUser)); // 사용자 정보 설정\n      setIsLoggedIn(true); // 로그인 상태 업데이트\n    }\n  }, []);\n\n  // 로그인 함수\n  const login = async (userId, password) => {\n    try {\n      const response = await axios.post('http://localhost:8000/signin', {\n        email: userId,\n        password,\n      });\n\n      if (response.status === 200) {\n        const userData = response.data.user; // 사용자 정보\n        const token = response.data.token; // JWT\n\n        setUser(userData);\n        saveToken(token); // 로컬 스토리지에 JWT 저장\n        localStorage.setItem('user', JSON.stringify(userData)); // 사용자 정보 저장\n        setIsLoggedIn(true); // 로그인 상태 업데이트\n\n        return response;\n      }\n    } catch (error) {\n      console.error('로그인 실패:', error);\n      throw error; // 오류를 상위로 전파\n    }\n  };\n\n//   // 소셜 로그인 함수\n//   const socialLogin = async (provider, { code, state }) => {\n//     try {\n//       const response = await apiClient.post(`/home/login/${provider}`, {\n//         code,\n//         state,\n//       });\n//       const userData = response.data.user; // 사용자 정보\n//       const token = response.data.token; // JWT\n\n//       setUser(userData);\n//       saveToken(token); // 로컬 스토리지에 JWT 저장\n//       localStorage.setItem('user', JSON.stringify(userData)); // 사용자 정보 저장\n//       setIsLoggedIn(true); // 로그인 상태 업데이트\n\n//       return response.data; // 응답 데이터 반환 (refreshToken 포함)\n//     } catch (error) {\n//       console.error('소셜 로그인 요청 중 오류 발생:', error);\n//       throw error; // 오류를 상위로 전파\n//     }\n//   };\n\n  const socialLogin = async (provider, { code, state }) => {\n    try {\n      const response = await apiClient.post(`/home/login/${provider}`, {\n        code,\n        state,\n      });\n      return response.data; // 응답 데이터 반환 (refreshToken 포함)\n    } catch (error) {\n      console.error('소셜 로그인 요청 중 오류 발생:', error);\n      throw error; // 오류를 상위로 전파\n    }\n  };\n\n\n\n// // 소셜 로그인 함수\n// export const socialLogin = async (provider, accessToken) => {\n//     try {\n//       const response = await apiClient.post(`/home/login/${provider}`, {\n//         accessToken,\n//       });\n  \n//       if (response.status === 200) {\n//         saveToken(response.data.token); // JWT 저장\n//         return response.data; // JWT 포함된 응답 데이터 반환\n//       }\n//     } catch (error) {\n//       console.error('소셜 로그인 실패:', error);\n//       throw error; // 오류를 상위로 전파\n//     }\n//   };\n\n  // 로그아웃 함수\n  const logout = (navigate) => {\n    setUser(null);\n    removeToken(); // 로컬 스토리지에서 JWT 제거\n    localStorage.removeItem('user'); // 사용자 정보 제거\n    setIsLoggedIn(false); // 로그인 상태 업데이트\n    navigate(\"/\"); // 홈으로 리디렉션\n  };\n\n  // Access Token 발급 요청 함수\n  const getAccessToken = async (refreshToken) => {\n    try {\n      const response = await apiClient.post('http://localhost:8000/refresh', {\n        email: \"pbh7080@gmail.com\", // 이메일을 하드코딩하거나 인자로 받을 수 있습니다.\n        refresh_token: refreshToken // 전달받은 refreshToken 사용\n      });\n\n      return response.data; // API 응답 반환\n    } catch (error) {\n      console.error('Access Token 발급 요청 중 오류 발생:', error);\n      return null;\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, isLoggedIn, login, logout, socialLogin, getAccessToken }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n//이거 이용하므로 export const으로 함수 export 할 필요 없음\n\n// Context 사용을 위한 커스텀 훅\nexport const useAuth = () => {\n  return useContext(AuthContext);\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}