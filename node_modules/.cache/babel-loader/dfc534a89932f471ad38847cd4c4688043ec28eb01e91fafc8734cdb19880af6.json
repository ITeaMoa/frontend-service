{"ast":null,"code":"// frontend-service/src/services/api.js\nimport axios from 'axios';\nimport { isTokenExpired, refreshAccessToken, clearTokens } from './auth';\nconst apiClient = axios.create({\n  baseURL: 'http://localhost:8000',\n  //process.env.REACT_APP_API_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\napiClient.interceptors.request.use(async config => {\n  var _document$cookie$spli2;\n  // Skip adding Authorization header for signin\n  if (config.url === '/signin') {\n    console.log('Skipping interceptor for /signin');\n    return config;\n  }\n  apiClient.interceptors.request.use(async config => {\n    var _document$cookie$spli;\n    // Skip adding Authorization header for signin\n    if (config.url === '/signin') {\n      console.log('Skipping interceptor for /signin');\n      return config;\n    }\n    let accessToken = sessionStorage.getItem('accessToken');\n    const refreshToken = (_document$cookie$spli = document.cookie.split('; ').find(row => row.startsWith('refreshToken='))) === null || _document$cookie$spli === void 0 ? void 0 : _document$cookie$spli.split('=')[1];\n    console.log('Current Access Token:', accessToken);\n    console.log('Current Refresh Token:', refreshToken);\n    if (!accessToken || isTokenExpired(accessToken)) {\n      if (!refreshToken) {\n        console.error('No refresh token found, redirecting to login...');\n        clearTokens();\n        window.location.href = '/LoginPage';\n        return Promise.reject(new Error('No refresh token found.'));\n      }\n      try {\n        console.log('Refreshing Access Token...');\n        accessToken = await refreshAccessToken(refreshToken);\n      } catch (error) {\n        console.error('Token refresh failed, redirecting to login...');\n        clearTokens();\n        window.location.href = '/LoginPage';\n        return Promise.reject(error);\n      }\n    }\n    config.headers.Authorization = `Bearer ${accessToken}`;\n    return config;\n  });\n  let accessToken = sessionStorage.getItem('accessToken');\n  const refreshToken = (_document$cookie$spli2 = document.cookie.split('; ').find(row => row.startsWith('refreshToken='))) === null || _document$cookie$spli2 === void 0 ? void 0 : _document$cookie$spli2.split('=')[1];\n  console.log('Current Access Token:', accessToken);\n  console.log('Current Refresh Token:', refreshToken);\n  if (!accessToken || isTokenExpired(accessToken)) {\n    if (!refreshToken) {\n      console.error('No refresh token found, redirecting to login...');\n      clearTokens();\n      window.location.href = '/LoginPage';\n      return Promise.reject(new Error('No refresh token found.'));\n    }\n    try {\n      console.log('Refreshing Access Token...');\n      accessToken = await refreshAccessToken(refreshToken);\n    } catch (error) {\n      console.error('Token refresh failed, redirecting to login...');\n      clearTokens();\n      window.location.href = '/LoginPage';\n      return Promise.reject(error);\n    }\n  }\n  config.headers.Authorization = `Bearer ${accessToken}`;\n  return config;\n});\nexport default apiClient;","map":{"version":3,"names":["axios","isTokenExpired","refreshAccessToken","clearTokens","apiClient","create","baseURL","headers","interceptors","request","use","config","_document$cookie$spli2","url","console","log","_document$cookie$spli","accessToken","sessionStorage","getItem","refreshToken","document","cookie","split","find","row","startsWith","error","window","location","href","Promise","reject","Error","Authorization"],"sources":["/Users/pbh7080/Desktop/project/ITeaMoa/frontend-service/src/services/api.js"],"sourcesContent":["// frontend-service/src/services/api.js\nimport axios from 'axios';\nimport { isTokenExpired, refreshAccessToken, clearTokens } from './auth';\n\nconst apiClient = axios.create({\n    baseURL: 'http://localhost:8000', //process.env.REACT_APP_API_URL,\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\napiClient.interceptors.request.use(async (config) => {\n    // Skip adding Authorization header for signin\n    if (config.url === '/signin') {\n        console.log('Skipping interceptor for /signin');\n        return config;\n    }\n    apiClient.interceptors.request.use(async (config) => {\n        // Skip adding Authorization header for signin\n        if (config.url === '/signin') {\n            console.log('Skipping interceptor for /signin');\n            return config;\n        }\n    \n        let accessToken = sessionStorage.getItem('accessToken');\n        const refreshToken = document.cookie.split('; ').find(row => row.startsWith('refreshToken='))\n                            ?.split('=')[1];\n    \n        console.log('Current Access Token:', accessToken);\n        console.log('Current Refresh Token:', refreshToken);\n    \n        if (!accessToken || isTokenExpired(accessToken)) {\n            if (!refreshToken) {\n                console.error('No refresh token found, redirecting to login...');\n                clearTokens();\n                window.location.href = '/LoginPage';\n                return Promise.reject(new Error('No refresh token found.'));\n            }\n    \n            try {\n                console.log('Refreshing Access Token...');\n                accessToken = await refreshAccessToken(refreshToken);\n            } catch (error) {\n                console.error('Token refresh failed, redirecting to login...');\n                clearTokens();\n                window.location.href = '/LoginPage';\n                return Promise.reject(error);\n            }\n        }\n    \n        config.headers.Authorization = `Bearer ${accessToken}`;\n        return config;\n    });\n    \n    let accessToken = sessionStorage.getItem('accessToken');\n    const refreshToken = document.cookie.split('; ').find(row => row.startsWith('refreshToken='))\n                        ?.split('=')[1];\n\n    console.log('Current Access Token:', accessToken);\n    console.log('Current Refresh Token:', refreshToken);\n\n    if (!accessToken || isTokenExpired(accessToken)) {\n        if (!refreshToken) {\n            console.error('No refresh token found, redirecting to login...');\n            clearTokens();\n            window.location.href = '/LoginPage';\n            return Promise.reject(new Error('No refresh token found.'));\n        }\n\n        try {\n            console.log('Refreshing Access Token...');\n            accessToken = await refreshAccessToken(refreshToken);\n        } catch (error) {\n            console.error('Token refresh failed, redirecting to login...');\n            clearTokens();\n            window.location.href = '/LoginPage';\n            return Promise.reject(error);\n        }\n    }\n\n    config.headers.Authorization = `Bearer ${accessToken}`;\n    return config;\n});\n\nexport default apiClient;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}